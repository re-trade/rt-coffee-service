on:
  push:
    branches:
      - main
      - deploy/add_migration_service
jobs:
  build-coffee-image:
    uses: ./.github/workflows/build-image.yaml
    permissions:
      contents: read
      packages: write
    with:
      actor: ${{ github.actor }}
      repository: ${{ github.repository }}
      token: ${{ secrets.GITHUB_TOKEN }}

  deploy-dev:
    uses: ./.github/workflows/deploy-dev.yaml
    permissions:
      contents: read
      packages: write
    with:
      actor: ${{ github.actor }}
      repository: ${{ github.repository }}
      token: ${{ secrets.GITHUB_TOKEN }}
    secrets:
      INFISICAL_URL: ${{secrets.INFISICAL_URL}}
      INFISICAL_CLIENT_ID: ${{secrets.INFISICAL_CLIENT_ID}}
      INFISICAL_CLIENT_SECRET: ${{secrets.INFISICAL_CLIENT_SECRET}}
      INFISICAL_PROJECT_ID: ${{secrets.INFISICAL_PROJECT_ID}}
